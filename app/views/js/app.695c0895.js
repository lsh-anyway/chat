(function(t){function e(e){for(var a,r,c=e[0],o=e[1],l=e[2],d=0,f=[];d<c.length;d++)r=c[d],s[r]&&f.push(s[r][0]),s[r]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);u&&u(e);while(f.length)f.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,c=1;c<n.length;c++){var o=n[c];0!==s[o]&&(a=!1)}a&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},s={1:0},i=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var u=o;i.push([29,0]),n()})({"/oR1":function(t,e,n){},"1/GE":function(t,e,n){},19:function(t,e){},29:function(t,e,n){t.exports=n("zUnb")},"4ENg":function(t,e,n){"use strict";var a=n("e/RK"),s=n.n(a);s.a},"5xSC":function(t,e,n){"use strict";var a=n("1/GE"),s=n.n(a);s.a},"78G3":function(t,e,n){},"9Mcw":function(t,e,n){"use strict";var a=n("vyDK"),s=n.n(a);s.a},ArZ4:function(t,e,n){},B4SN:function(t,e,n){"use strict";var a=n("UtaM"),s=n.n(a);s.a},FGND:function(t,e,n){"use strict";var a=n("mQhM"),s=n.n(a);s.a},HSFD:function(t,e,n){},Hw56:function(t,e,n){"use strict";var a=n("HSFD"),s=n.n(a);s.a},"I4/2":function(t,e,n){},L8xS:function(t,e,n){"use strict";var a=n("c72D"),s=n.n(a);s.a},LsxC:function(t,e,n){"use strict";var a=n("p510"),s=n.n(a);s.a},"M+17":function(t,e,n){},UtaM:function(t,e,n){},WCSo:function(t,e,n){"use strict";var a=n("I4/2"),s=n.n(a);s.a},WM7U:function(t,e,n){"use strict";var a=n("/oR1"),s=n.n(a);s.a},Zhha:function(t,e,n){"use strict";var a=n("ArZ4"),s=n.n(a);s.a},"a+fc":function(t,e,n){"use strict";var a=n("zEU7"),s=n.n(a);s.a},b2p5:function(t,e,n){"use strict";var a=n("lO1E"),s=n.n(a);s.a},c72D:function(t,e,n){},dQlP:function(t,e,n){"use strict";var a=n("M+17"),s=n.n(a);s.a},"e/RK":function(t,e,n){},eqQV:function(t,e,n){"use strict";var a=n("78G3"),s=n.n(a);s.a},lO1E:function(t,e,n){},mQhM:function(t,e,n){},nNx0:function(t,e,n){"use strict";var a=n("uWEC"),s=n.n(a);s.a},p510:function(t,e,n){},uWEC:function(t,e,n){},vyDK:function(t,e,n){},zEU7:function(t,e,n){},zUnb:function(t,e,n){"use strict";n.r(e);n("VRzm");var a=n("Kw5r"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},i=[],r=(n("nNx0"),n("KHd+")),c={},o=Object(r["a"])(c,s,i,!1,null,null,null),l=o.exports,u=n("jE9Z"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login"},[n("div",{staticClass:"title"},[t._v("CHAT")]),n("el-form",{attrs:{model:t.user,"label-width":"3rem"}},[n("el-form-item",{attrs:{label:"账号"}},[n("el-input",{attrs:{placeholder:"请输入用户名或邮箱"},model:{value:t.user.username,callback:function(e){t.$set(t.user,"username",e)},expression:"user.username"}})],1),n("el-form-item",{attrs:{label:"密码"}},[n("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:t.user.password,callback:function(e){t.$set(t.user,"password",e)},expression:"user.password"}})],1),n("el-form-item",[n("el-button",{on:{click:t.login}},[t._v("登录")])],1)],1),n("div",{staticClass:"nav"},[n("router-link",{attrs:{to:"/signup"}},[t._v("创建一个新账户>>>")])],1),n("div",{staticClass:"footer"},[n("i",{staticClass:"icon-github",on:{click:t.loginByGitHub}},[t._v("GitHub登录")])])],1)},f=[],p=n("xmWZ"),v=n("3Aqn"),h=n("qpph"),m=n("0yhX"),b=n("EdlT"),g=n("mrSG"),y=n("YKMj"),_=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.user={username:"",password:""},t}return Object(h["a"])(e,[{key:"login",value:function(){var t=this,e=this.user,n=e.username,a=e.password;this.axios.post("/user/signin",{username:n,password:a}).then(function(e){localStorage.setItem("token",e.token),t.$message({message:"登录成功",type:"success"}),t.$router.push("/")}).catch(function(e){e.response?t.$message("用户名或密码错误"):t.$message("网络连接错误")})}},{key:"loginByGitHub",value:function(){window.location.href="https://github.com/login/oauth/authorize?client_id=55b07150945744c997bf"}}]),Object(v["a"])(e,t),e}(y["c"]);_=g["a"]([y["a"]],_);var O=_,j=O,C=(n("a+fc"),Object(r["a"])(j,d,f,!1,null,"6c9b07d9",null)),k=C.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login"},[n("div",{staticClass:"title"},[t._v("CHAT")]),n("el-form",{attrs:{model:t.user,"label-width":"4rem"}},[n("el-form-item",{attrs:{label:"用户名"}},[n("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:t.user.username,callback:function(e){t.$set(t.user,"username",e)},expression:"user.username"}})],1),n("el-form-item",{attrs:{label:"昵称"}},[n("el-input",{attrs:{placeholder:"请输入昵称"},model:{value:t.user.nickname,callback:function(e){t.$set(t.user,"nickname",e)},expression:"user.nickname"}})],1),n("el-form-item",{attrs:{label:"邮箱"}},[n("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:t.user.email,callback:function(e){t.$set(t.user,"email",e)},expression:"user.email"}})],1),n("el-form-item",{attrs:{label:"密码"}},[n("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:t.user.password,callback:function(e){t.$set(t.user,"password",e)},expression:"user.password"}})],1),n("el-form-item",[n("el-button",{nativeOn:{click:function(e){return t.signup(e)}}},[t._v("注册")])],1)],1),n("router-link",{attrs:{to:"/login"}},[t._v("返回登录>>>")])],1)},x=[],S=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.user={username:"",nickname:"",email:"",password:""},t}return Object(h["a"])(e,[{key:"signup",value:function(){var t=this,e=this.user,n=e.username,a=e.nickname,s=e.email,i=e.password;this.axios.post("/user/signup",{username:n,nickname:a,email:s,password:i}).then(function(e){localStorage.setItem("token",e.token),t.$message({message:"注册成功",type:"success"}),t.$router.push("/")}).catch(function(e){if(console.log(e.response),400===e.response.status){var n=e.response.data,a=n.details[0].path[0];switch(a){case"username":t.$message("用户名必须为4-16位的英文字母和数字的组合");break;case"nickname":t.$message("昵称不能为空");break;case"email":t.$message("请输入正确的邮箱");break;case"password":t.$message("密码必须为6-16位的英文字母和数字的组合");break}}else 403===e.response.status?t.$message("该用户已存在"):t.$message("网络连接错误")})}}]),Object(v["a"])(e,t),e}(y["c"]);S=g["a"]([y["a"]],S);var E=S,$=E,U=(n("WM7U"),Object(r["a"])($,w,x,!1,null,"5f20f9e4",null)),D=U.exports,I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("div",{staticClass:"left-side"},[n("main-content")],1),t.content.isActive?n("div",{staticClass:"right-side"},["showAddFriend"===t.content.activeType?n("verification"):t._e(),"verify"===t.content.activeType?n("verify-list"):t._e(),"friendPanel"===t.content.activeType?n("friend-panel"):t._e(),"dialog"===t.content.activeType?n("dialog-panel"):t._e()],1):t._e()])},A=[],F=n("S7WH"),M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"main-content"},[n("vue-header",{on:{showSearch:t.showSearch}}),n("keep-alive",[n("router-view")],1),n("tab-bar"),t.searching?n("search",{attrs:{searchContent:t.searchContent},on:{closeSearch:t.closeSearch}}):t._e()],1)},N=[],P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tab-bar"},[n("router-link",{staticClass:"tab-bar-item",attrs:{to:"/chat"}},[n("i",{staticClass:"icon-chat"}),n("span",[t._v("聊天")])]),n("router-link",{staticClass:"tab-bar-item",attrs:{to:"/contacts"}},[n("i",{staticClass:"icon-contacts"}),n("span",[t._v("通讯录")])]),n("router-link",{staticClass:"tab-bar-item",attrs:{to:"/me"}},[n("i",{staticClass:"icon-home"}),n("span",[t._v("我")])])],1)},T=[],G=function(t){function e(){return Object(p["a"])(this,e),Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments))}return Object(v["a"])(e,t),e}(y["c"]);G=g["a"]([y["a"]],G);var H=G,R=H,Q=(n("Zhha"),Object(r["a"])(R,P,T,!1,null,"28d07dde",null)),z=Q.exports,V=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vueHeader"},[t._v("\n\t"+t._s(t.$route.name)+"\n\t"),n("el-dropdown",{staticClass:"drop-down",attrs:{trigger:"click"},on:{command:t.handleCommand}},[n("span",{staticClass:"el-dropdown-link"},[n("i",{staticClass:"icon-add"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"添加好友"}},[t._v("添加好友")]),n("el-dropdown-item",{attrs:{command:"添加群聊"}},[t._v("添加群聊")])],1)],1)],1)},q=[],K=function(t){function e(){return Object(p["a"])(this,e),Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments))}return Object(h["a"])(e,[{key:"handleCommand",value:function(t){this.$emit("showSearch",t)}}]),Object(v["a"])(e,t),e}(y["c"]);K=g["a"]([y["a"]],K);var W=K,L=W,B=(n("LsxC"),Object(r["a"])(L,V,q,!1,null,"ca07555e",null)),Z=B.exports,J=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"search"},[n("header",[n("i",{staticClass:"el-icon-arrow-left",on:{click:t.closeSearch}},[t._v("返回")]),t._v("\n\t\t"+t._s(t.searchContent)+"\n\t")]),"添加好友"===t.searchContent?n("div",{staticClass:"form-inline"},[n("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入用户名,昵称或邮箱"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),n("i",{staticClass:"el-icon-search",on:{click:t.onSubmit}})],1):t._e(),"添加好友"===t.searchContent?n("users-list",{attrs:{users:t.users}}):t._e(),"添加群聊"===t.searchContent?n("div",{staticClass:"form-inline"},[n("el-input",{attrs:{placeholder:"请输入昵称"},model:{value:t.nickname,callback:function(e){t.nickname=e},expression:"nickname"}})],1):t._e()],1)},Y=[],X=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"users-list"},t._l(t.users,function(e){return n("li",{key:e._id,staticClass:"user-item",on:{click:function(n){t.selectUser(e)}}},[n("img",{staticClass:"avatar",attrs:{src:t.baseUrl+e.avatar,width:"32",height:"32s"}}),n("div",{staticClass:"user-info"},[n("p",{staticClass:"nickname"},[t._v(t._s(e.nickname))]),n("p",{staticClass:"username"},[t._v(t._s(e.username))])])])}))},tt=[],et=(n("rGqo"),"http://localhost:3000");et="";var nt=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.baseUrl=et,t}return Object(h["a"])(e,[{key:"selectUser",value:function(t){var e=this;console.log(t);var n=this.friends,a=this.user;if(a._id===t._id)return this.$message("不能添加自己为好友");n.forEach(function(n){if(n._id===t._id)return e.$message("该用户已在您的好友列表中")}),this.showAddFriend(t)}}]),Object(v["a"])(e,t),e}(y["c"]);g["a"]([Object(y["b"])(Array),g["b"]("design:type",Object)],nt.prototype,"users",void 0),g["a"]([F["c"],g["b"]("design:type",Object)],nt.prototype,"friends",void 0),g["a"]([F["c"],g["b"]("design:type",Object)],nt.prototype,"user",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],nt.prototype,"showAddFriend",void 0),nt=g["a"]([y["a"]],nt);var at=nt,st=at,it=(n("WCSo"),Object(r["a"])(st,X,tt,!1,null,"259ec0d3",null)),rt=it.exports,ct=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.username="",t.nickname="",t.users=[],t}return Object(h["a"])(e,[{key:"closeSearch",value:function(){this.$emit("closeSearch")}},{key:"onSubmit",value:function(){var t=this;if("添加好友"===this.searchContent){if(!this.username)return this.$message("请输入搜索信息");this.axios.get("/user/find/".concat(this.username)).then(function(e){t.users=e})}}}]),Object(v["a"])(e,t),e}(y["c"]);g["a"]([Object(y["b"])(String),g["b"]("design:type",String)],ct.prototype,"searchContent",void 0),ct=g["a"]([Object(y["a"])({components:{usersList:rt}})],ct);var ot=ct,lt=ot,ut=(n("5xSC"),Object(r["a"])(lt,J,Y,!1,null,"49a15b80",null)),dt=ut.exports,ft=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.searching=!1,t.searchContent="",t}return Object(h["a"])(e,[{key:"closeSearch",value:function(){this.searching=!1}},{key:"showSearch",value:function(t){this.searchContent=t,this.searching=!0}}]),Object(v["a"])(e,t),e}(y["c"]);ft=g["a"]([Object(y["a"])({components:{TabBar:z,vueHeader:Z,search:dt}})],ft);var pt=ft,vt=pt,ht=(n("dQlP"),Object(r["a"])(vt,M,N,!1,null,"a177573e",null)),mt=ht.exports,bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"verification"},[n("header",[n("i",{staticClass:"el-icon-arrow-left",on:{click:t.clearContent}},[t._v("返回")]),t._v("\n\t\t好友申请\n\t")]),n("div",{staticClass:"content"},[n("span",{staticClass:"title"},[t._v("发送验证消息")]),n("div",{staticClass:"form"},[n("el-input",{model:{value:t.verifyInfo,callback:function(e){t.verifyInfo=e},expression:"verifyInfo"}}),n("el-button",{on:{click:t.verify}},[t._v("发送")])],1)])])},gt=[],yt=n("gFX4"),_t=n.n(yt),Ot=n("L2JU"),jt={connecting:!1,user:{_id:"",nickname:"",avatar:""},friends:[],dialogs:[],content:{isActive:!1,activeType:"",activeContent:null},verifications:[]},Ct=jt,kt=(n("f3/d"),{user:function(t){var e=t.user;return e.avatar&&(e.avatar=et+e.avatar),e},dialogs:function(t){var e=t.user,n=t.dialogs;return n.forEach(function(t){t.name&&0!==t.name.length||t.members.forEach(function(n){n._id!==e._id&&(t.name=n.nickname)})}),n}}),wt=kt,xt=(n("ls82"),n("MECJ")),St=n("1uFK"),Et=new St["a"]("friends"),$t=new St["a"]("dialogs"),Ut=new St["a"]("verifications");function Dt(){return It.apply(this,arguments)}function It(){return It=Object(xt["a"])(regeneratorRuntime.mark(function t(){var e,n,a,s,i,r,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Et.allDocs({include_docs:!0});case 2:return e=t.sent,t.next=5,$t.allDocs({include_docs:!0});case 5:return n=t.sent,t.next=8,Ut.allDocs({include_docs:!0});case 8:return a=t.sent,s=e.rows.map(function(t){return t.doc}),i=n.rows.map(function(t){return t.doc}),r=a.rows.map(function(t){return t.doc}),c={_id:localStorage.getItem("_id"),avatar:localStorage.getItem("avatar"),nickname:localStorage.getItem("nickname")},t.abrupt("return",{user:c,friends:s,dialogs:i,verifications:r});case 14:case"end":return t.stop()}},t,this)})),It.apply(this,arguments)}function At(t){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(xt["a"])(regeneratorRuntime.mark(function t(e){var n,a,s,i,r,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=e._id,a=e.avatar,s=e.nickname,i=e.friends,r=e.dialogs,c=e.verifications,localStorage.setItem("_id",n),localStorage.setItem("avatar",a),localStorage.setItem("nickname",s),r.forEach(function(t){t.num=t.messages.length}),t.next=7,Et.bulkDocs(i);case 7:return t.next=9,$t.bulkDocs(r);case 9:return t.next=11,Ut.bulkDocs(c);case 11:return t.abrupt("return",Dt());case 12:case"end":return t.stop()}},t,this)})),Ft.apply(this,arguments)}function Mt(){Et.destroy(),$t.destroy(),Ut.destroy()}var Nt={setSocket:function(t){t.connecting=!0},setUserInfo:function(t,e){t.user=e.user,t.friends=e.friends,t.dialogs=e.dialogs,t.verifications=e.verifications},clearUserInfo:function(t){t.user={_id:"",nickname:"",avatar:""},t.friends=[],t.dialogs=[],t.verifications=[],Mt()},addFriend:function(t,e){t.friends.push(e),t.verifications=t.verifications.filter(function(t){return t.from._id!==e._id})},showAddFriend:function(t,e){t.content.isActive=!0,t.content.activeType="showAddFriend",t.content.activeContent=e},showFriendPanel:function(t,e){t.content.isActive=!0,t.content.activeType="friendPanel",t.content.activeContent=e},showVerification:function(t){t.content.isActive=!0,t.content.activeType="verify",t.content.activeContent=null},showDialog:function(t,e){t.content.isActive=!0,t.content.activeType="dialog",t.content.activeContent=e,zt.emit("read",e._id)},addVerifications:function(t,e){t.verifications.push(e)},clearContent:function(t){t.content.isActive=!1,t.content.activeType="",t.content.activeContent=null},addDialog:function(t,e){e.num=0,t.dialogs.push(e)},addMessage:function(t,e){t.dialogs.forEach(function(t){t._id===e.dialog&&(t.messages.push(e),t.num++)})},clearDialogNum:function(t,e){var n=t.dialogs.filter(function(t){return t._id===e});n[0].num=0}},Pt=Nt,Tt=n("vDqi"),Gt=n.n(Tt),Ht={getUserInfo:function(){var t=Object(xt["a"])(regeneratorRuntime.mark(function t(e,n){var a,s,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e.state,a=e.commit,t.next=3,Gt.a.get("/user/info",{headers:{Authorization:n}});case 3:return s=t.sent,t.next=6,At(s);case 6:i=t.sent,Vt(i.user._id),i&&a("setUserInfo",i);case 9:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},Rt=Ht;a["default"].use(Ot["a"]);var Qt=new Ot["a"].Store({state:Ct,getters:wt,mutations:Pt,actions:Rt}),zt=_t()("http://localhost:3000");function Vt(t){zt.emit("init",{id:t}),zt.on("success",function(){Qt.commit("setSocket"),console.log("connecting...")}),zt.on("verify",function(t){Qt.commit("addVerifications",t)}),zt.on("agree",function(t){Qt.commit("addFriend",t)}),zt.on("message",function(t){Qt.commit("addMessage",t)})}var qt=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.verifyInfo="",t}return Object(h["a"])(e,[{key:"verify",value:function(){console.log(this.content),zt.emit("verify",{to:this.content.activeContent._id,content:this.verifyInfo}),this.clearContent()}}]),Object(v["a"])(e,t),e}(y["c"]);g["a"]([F["c"],g["b"]("design:type",Object)],qt.prototype,"content",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],qt.prototype,"clearContent",void 0),qt=g["a"]([y["a"]],qt);var Kt=qt,Wt=Kt,Lt=(n("eqQV"),Object(r["a"])(Wt,bt,gt,!1,null,"5e1e0b0a",null)),Bt=Lt.exports,Zt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrapper"},[n("header",[n("i",{staticClass:"el-icon-arrow-left",on:{click:t.clearContent}},[t._v("返回")]),t._v("\n\t\t好友申请\n\t")]),n("ul",{staticClass:"verify-list"},t._l(t.verifications,function(e){return n("li",{key:e._id,staticClass:"verify-item"},[n("img",{staticClass:"avatar",attrs:{src:t.baseUrl+e.from.avatar,width:"32",height:"32"}}),n("div",{staticClass:"info"},[n("span",{staticClass:"nickname"},[t._v(t._s(e.from.nickname))]),n("span",{staticClass:"message"},[t._v("消息："+t._s(e.content))])]),n("el-button",{attrs:{size:"small"},on:{click:function(n){t.agree(e)}}},[t._v("同意")])],1)}))])},Jt=[],Yt=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.baseUrl=et,t}return Object(h["a"])(e,[{key:"agree",value:function(t){zt.emit("agree",t),this.addFriend(t.from)}}]),Object(v["a"])(e,t),e}(y["c"]);g["a"]([F["c"],g["b"]("design:type",Object)],Yt.prototype,"verifications",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],Yt.prototype,"clearContent",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],Yt.prototype,"addFriend",void 0),Yt=g["a"]([y["a"]],Yt);var Xt=Yt,te=Xt,ee=(n("FGND"),Object(r["a"])(te,Zt,Jt,!1,null,"557023e4",null)),ne=ee.exports,ae=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"friend-panel"},[n("header",[n("i",{staticClass:"el-icon-arrow-left",on:{click:t.clearContent}},[t._v("返回")])]),n("div",{staticClass:"panel"},[n("img",{staticClass:"avatar",attrs:{src:t.baseUrl+t.content.activeContent.avatar,width:"200",height:"200"}}),n("div",{staticClass:"nickname"},[t._v(t._s(t.content.activeContent.nickname))]),n("el-button",{on:{click:t.sendMessage}},[t._v("发送消息")])],1)])},se=[],ie=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.baseUrl=et,t}return Object(h["a"])(e,[{key:"sendMessage",value:function(){var t,e=this,n=this.content.activeContent._id,a=this.user._id;if(this.dialogs.forEach(function(e){2===e.members.length&&-1!==e.members.indexOf(n)&&e.members.forEach(function(a){a._id===n&&(t=e)})}),t)this.showDialog(t);else{t={members:[a,n]};var s=localStorage.getItem("token");this.axios.post("/dialog/create",t,{headers:{Authorization:s}}).then(function(t){e.addDialog(t),e.clearContent(),e.showDialog(t)})}}}]),Object(v["a"])(e,t),e}(y["c"]);g["a"]([F["b"],g["b"]("design:type",Object)],ie.prototype,"clearContent",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],ie.prototype,"addDialog",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],ie.prototype,"showDialog",void 0),g["a"]([F["c"],g["b"]("design:type",Object)],ie.prototype,"content",void 0),g["a"]([F["c"],g["b"]("design:type",Object)],ie.prototype,"dialogs",void 0),g["a"]([F["c"],g["b"]("design:type",Object)],ie.prototype,"user",void 0),ie=g["a"]([y["a"]],ie);var re=ie,ce=re,oe=(n("4ENg"),Object(r["a"])(ce,ae,se,!1,null,"5ffbf502",null)),le=oe.exports,ue=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dialog-panel"},[n("header",[n("i",{staticClass:"el-icon-arrow-left",on:{click:t.clearContent}},[t._v("返回")]),t._v("\n\t\t\t"+t._s(t.dialog.name)+"\n\t\t")]),n("ul",{staticClass:"message-list"},t._l(t.dialog.messages,function(e){return n("li",{key:e.id,staticClass:"message",class:{myMessage:e.from._id===t.user._id}},[n("img",{staticClass:"avatar",attrs:{src:t.baseUrl+e.from.avatar,width:"32",height:"32"}}),n("i"),n("span",{staticClass:"content"},[t._v("\n                    "+t._s(e.content)+"\n                ")])])})),n("el-form",{staticClass:"form",attrs:{inline:!0,size:"small"}},[n("el-form-item",{staticClass:"input"},[n("el-input",{model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1),n("el-form-item",{staticClass:"button"},[n("el-button",{on:{click:t.send}},[t._v("发送")])],1)],1)],1)},de=[],fe=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.message="",t.baseUrl=et,t}return Object(h["a"])(e,[{key:"send",value:function(){var t={dialog:this.dialog._id,from:this.user._id,content:this.message};this.message="",zt.emit("message",t)}},{key:"read",value:function(){this.clearDialogNum(this.dialog._id),zt.emit("read",this.dialog._id)}},{key:"dialog",get:function(){return this.content.activeContent}}]),Object(v["a"])(e,t),e}(y["c"]);g["a"]([F["b"],g["b"]("design:type",Object)],fe.prototype,"clearContent",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],fe.prototype,"clearDialogNum",void 0),g["a"]([F["c"],g["b"]("design:type",Object)],fe.prototype,"content",void 0),g["a"]([F["c"],g["b"]("design:type",Object)],fe.prototype,"user",void 0),g["a"]([Object(y["d"])("dialog.messages"),g["b"]("design:type",Function),g["b"]("design:paramtypes",[]),g["b"]("design:returntype",void 0)],fe.prototype,"read",null),fe=g["a"]([y["a"]],fe);var pe=fe,ve=pe,he=(n("Hw56"),Object(r["a"])(ve,ue,de,!1,null,"51153f6a",null)),me=he.exports,be=function(t){function e(){return Object(p["a"])(this,e),Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments))}return Object(v["a"])(e,t),e}(y["c"]);g["a"]([F["c"],g["b"]("design:type",Object)],be.prototype,"content",void 0),be=g["a"]([Object(y["a"])({components:{mainContent:mt,verification:Bt,verifyList:ne,friendPanel:le,dialogPanel:me}})],be);var ge=be,ye=ge,_e=(n("b2p5"),Object(r["a"])(ye,I,A,!1,null,"81d5f732",null)),Oe=_e.exports,je=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"dialogs-list"},t._l(t.dialogs,function(e){return n("li",{key:e._id,staticClass:"dialog-item",on:{click:function(n){t.clickDialog(e)}}},[n("img",{staticClass:"avatar",attrs:{src:t.getImgUrl(e),width:"32",height:"32"}}),n("div",{staticClass:"content-wrapper"},[n("p",{staticClass:"nickname"},[t._v(t._s(e.name))]),n("p",{staticClass:"content"},[t._v(t._s(t.getContent(e)))])]),e.num>0?n("span",{staticClass:"num"},[t._v(t._s(e.num))]):t._e()])}))},Ce=[],ke=function(t){function e(){return Object(p["a"])(this,e),Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments))}return Object(h["a"])(e,[{key:"getImgUrl",value:function(t){var e,n=this;return 2===t.members.length&&t.members.forEach(function(t){t._id!==n.user._id&&(e=et+t.avatar)}),e}},{key:"getContent",value:function(t){if(t.messages.length>0){var e=t.messages,n=e[e.length-1],a=n.from.nickname,s=n.content;return"".concat(a,": ").concat(s)}}},{key:"clickDialog",value:function(t){this.showDialog(t),this.clearDialogNum(t._id)}}]),Object(v["a"])(e,t),e}(y["c"]);g["a"]([F["a"],g["b"]("design:type",Object)],ke.prototype,"dialogs",void 0),g["a"]([F["a"],g["b"]("design:type",Object)],ke.prototype,"user",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],ke.prototype,"showDialog",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],ke.prototype,"clearDialogNum",void 0),ke=g["a"]([y["a"]],ke);var we=ke,xe=we,Se=(n("9Mcw"),Object(r["a"])(xe,je,Ce,!1,null,"482cd9c0",null)),Ee=Se.exports,$e=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"contacts"},[n("div",{staticClass:"applications",on:{click:t.showVerification}},[n("span",{staticClass:"title"},[t._v("好友申请")]),n("span",{staticClass:"num"},[t._v(t._s(t.verifications.length))])]),n("ul",{staticClass:"friends-list"},t._l(t.friends,function(e){return n("li",{key:e._id,staticClass:"friend-item",on:{click:function(n){t.showFriendPanel(e)}}},[n("img",{staticClass:"avatar",attrs:{src:t.baseUrl+e.avatar,width:"32",height:"32"}}),n("span",{staticClass:"nickname"},[t._v(t._s(e.nickname))])])}))])},Ue=[],De=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments)),t.baseUrl=et,t}return Object(v["a"])(e,t),e}(y["c"]);g["a"]([F["c"],g["b"]("design:type",Object)],De.prototype,"verifications",void 0),g["a"]([F["c"],g["b"]("design:type",Object)],De.prototype,"friends",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],De.prototype,"showVerification",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],De.prototype,"showFriendPanel",void 0),De=g["a"]([y["a"]],De);var Ie=De,Ae=Ie,Fe=(n("B4SN"),Object(r["a"])(Ae,$e,Ue,!1,null,"7dafbc3c",null)),Me=Fe.exports,Ne=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"me"},[n("div",{staticClass:"info"},[n("img",{staticClass:"avatar",attrs:{src:t.user.avatar,width:"100",height:"100"}}),n("div",{staticClass:"name"},[t._v(t._s(t.user.nickname))])]),n("div",{staticClass:"log-out",on:{click:t.logout}},[t._v("退出登录")])])},Pe=[],Te=function(t){function e(){return Object(p["a"])(this,e),Object(m["a"])(this,Object(b["a"])(e).apply(this,arguments))}return Object(h["a"])(e,[{key:"logout",value:function(){localStorage.clear(),this.clearUserInfo(),this.$router.push("/login")}}]),Object(v["a"])(e,t),e}(y["c"]);g["a"]([F["a"],g["b"]("design:type",Object)],Te.prototype,"user",void 0),g["a"]([F["b"],g["b"]("design:type",Object)],Te.prototype,"clearUserInfo",void 0),Te=g["a"]([y["a"]],Te);var Ge=Te,He=Ge,Re=(n("L8xS"),Object(r["a"])(He,Ne,Pe,!1,null,"5dda5af0",null)),Qe=Re.exports;a["default"].use(u["a"]);var ze=new u["a"]({mode:"history",routes:[{path:"/login",name:"login",component:k},{path:"/signup",name:"signup",component:D},{path:"/",component:Oe,children:[{path:"/",redirect:"/chat"},{path:"/chat",name:"聊天",component:Ee},{path:"/contacts",name:"通讯录",component:Me},{path:"/me",name:"我",component:Qe}]}]}),Ve=(n("9d8Q"),n("lIOY"));Object(Ve["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});n("D7fx"),n("RQ3N");var qe=n("9SnE"),Ke=n.n(qe),We=(n("lg3i"),n("3vv1")),Le=n.n(We),Be=(n("vUnn"),n("GP+6")),Ze=n.n(Be),Je=(n("y3Cl"),n("s3Cy")),Ye=n.n(Je),Xe=(n("ribW"),n("hF+1")),tn=n.n(Xe),en=(n("GVEf"),n("7t/g")),nn=n.n(en),an=(n("7Kd7"),n("N4fY")),sn=n.n(an),rn=(n("Ql/2"),n("QQVE")),cn=n.n(rn),on=(n("EMu8"),n("8606")),ln=n.n(on);a["default"].use(ln.a),a["default"].use(cn.a),a["default"].use(sn.a),a["default"].use(nn.a),a["default"].use(tn.a),a["default"].use(Ye.a),a["default"].use(Ze.a),a["default"].use(Le.a),a["default"].prototype.$message=Ke.a,Gt.a.defaults.baseURL=et,Gt.a.interceptors.response.use(function(t){return t.data},function(t){return Promise.reject(t)}),a["default"].config.productionTip=!1,a["default"].prototype.axios=Gt.a,ze.beforeEach(function(t,e,n){var a=t.path,s=localStorage.getItem("token"),i=Qt.state.connecting,r=t.query.code;switch(a){case"/login":case"/signup":if(i)return n("/");if(!s)return n();s&&Qt.dispatch("getUserInfo",s).then(function(){n("/")}).catch(function(t){n()});break;default:if(i)return n();if(!s&&!r)return n("/login");s?(n(),Qt.dispatch("getUserInfo",s)):r&&Gt.a.get("/user/oauth/github",{params:{code:t.query.code}}).then(function(t){n(),localStorage.setItem("token",t.token),Qt.dispatch("getUserInfo",t.token)}).catch(function(){n("/login")})}}),new a["default"]({router:ze,store:Qt,render:function(t){return t(l)}}).$mount("#app")}});
//# sourceMappingURL=app.695c0895.js.map